# NanoClaw 요구사항 (Requirements)

프로젝트 창시자가 작성한 초기 요구사항 및 설계 결정 사항입니다.

---

## 프로젝트 존재 이유

이 프로젝트는 OpenClaw(구 ClawBot)의 가볍고 안전한 대안입니다. 기존 프로젝트는 여러 형태의 게이트웨이를 실행하는 4~5개의 다른 프로세스들, 엄청나게 많은 설정 파일들, 그리고 끝없는 외부 연동 등을 품은 거대한 괴물이 되었습니다. 무엇보다 에이전트들이 격리된 프로세스에서 실행되지 않아 보안상의 악몽이었고, 시스템 접근을 막기 위한 허술한 임시방편들이 난무했습니다. 누구라도 현실적으로 전체 코드베이스를 이해하기 불가능한 상태였고, 이를 실행한다는 것은 사실상 "될 대로 되라(Yolo)"는 식의 모험이었습니다.

NanoClaw는 이러한 혼란을 덜어내고 핵심적인 기능만을 제공합니다.

---

## 철학

### 이해할 수 있을 만큼 작을 것

전체 코드는 누구나 읽고 이해할 수 있어야 합니다. 단일 Node.js 프로세스 구조와 한 줌의 소스 파일들로만 이루어집니다. 복잡한 마이크로서비스나 메시지 큐, 번잡한 추상화 레이어를 사용하지 않습니다.

### 진정한 격리를 통한 보안

에이전트가 무언가에 접근하는 것을 억지로 막기 위해 애플리케이션 수준의 권한 제어 시스템을 두는 대신, 에이전트들을 실제 Linux 컨테이너 내부에서 구동시킵니다. 시스템 OS 레벨에서의 격리입니다. 에이전트는 명시적으로 마운트된 영역들만 볼 수 있습니다. 모든 명령어는 호스트(Mac, Windows 등)가 아닌 컨테이너 내부에서만 안전하게 실행되므로 Bash 접근 권한을 주는 것도 문제 되지 않습니다.

### 단 한 명의 사용자를 위해 만들어짐

웹 프레임워크나 기업용 플랫폼이 아닙니다. 개인적인 필요를 위해 동작하는 소프트웨어입니다. 내가 WhatsApp과 이메일을 주로 쓴다면, 이 프로그램은 WhatsApp과 이메일만을 지원합니다. 텔레그램을 쓰지 않으면 텔레그램을 지원하지 않습니다. 있을 수 있는 모든 연동 기능을 구겨 넣는 것이 아니라 내가 진짜 원하는 연동 기능만 추가합니다.

### 커스터마이징 = 코드 변경

설정값이 거미줄처럼 퍼져나가는 것을 지양합니다. 소프트웨어의 동작 방식을 다르게 하고 싶다면 코드를 수정하세요. 코드 크기가 워낙 작기 때문에 이렇게 하는 것이 안전하고 현실적입니다. 봇을 호출할 트리거 단어 같은 아주 기본적인 것만 설정(`config`)으로 남기고 나머지는 원하는 대로 동작하도록 직접 코드를 바꾸면 됩니다.

### AI 네이티브(AI-Native) 개발 추구

복잡한 설치 마법사 따위는 필요 없습니다 - Claude Code가 설치를 가이드합니다. 모니터링 대시보드도 필요 없습니다 - Claude Code에게 무슨 일이 일어나고 있는지 물어봅니다. 정교하고 화려한 로그 UI도 필요 없습니다 - Claude가 로그를 읽어줍니다. 각양각색의 디버깅 툴도 필요 없습니다 - 문제를 말해주면 Claude가 고칩니다.

이 코드베이스는 항상 AI 협력자가 당신 곁에 있다는 가정을 바탕으로 합니다. Claude가 언제나 대기 중이므로 코드 자체가 과도하게 친절한 주석이나 자체 디버깅 로직을 곁들일 필요가 없습니다.

### 기능(Features)보다는 기술(Skills)

오픈소스 기여자들이 "WhatsApp 옆에 통신기능으로써 텔레그램도 지원하자" 형태로 코어 프로젝트를 수정해서는 안 됩니다. 대신 그들은 코드베이스의 형태를 탈바꿈시킬 `/add-telegram`과 같은 **스킬(Skill)**들을 기여해야 합니다. 사용자는 저장소(repo)를 포크(Fork)하고, 스킬을 실행해 자신만의 환경을 커스텀하게 구성하여, 쓸데없이 만인의 요구사항을 다 충족시키려 헛배가 부른 시스템 대신 내게 꼭 맞는 깨끗한 코드를 가질 수 있게 됩니다.

---

## RFS (Request for Skills, 스킬 제작 요청)

기여자들이 만들어주었으면 하는 스킬 목록입니다:

### 소통 채널들 (Communication Channels)
다른 메신저 플랫폼을 추가하거나 기존 채널을 전환하는 스킬들:
- `/add-telegram` - 입력 채널로 텔레그램 추가
- `/add-slack` - 입력 채널로 슬랙 추가
- `/add-discord` - 입력 채널로 디스코드 추가
- `/add-sms` - Twilio 등을 사용한 SMS 기능 추가
- `/convert-to-telegram` - WhatsApp을 걷어내고 텔레그램으로 완전히 대체

### 컨테이너 런타임 (Container Runtime)
현재 크로스 플랫폼 호환을 위해 Docker를 기본으로 사용합니다. 하지만 macOS 사용자 중 Apple 컨테이너를 선호하는 분들을 위해:
- `/convert-to-apple-container` - Docker에서 Apple 컨테이너 시스템으로 전환 (macOS 전용)

### 플랫폼 지원 (Platform Support)
- `/setup-linux` - Linux 환경에서 전체 설정이 작동하도록 구성 (기존 Docker 전환 여부에 의존함)
- `/setup-windows` - WSL2 + Docker를 통한 Windows 지원

---

## 비전

최소한의 커스텀 코드만으로 구동되는, WhatsApp을 통해 언제든 연락할 수 있는 나만의 퍼스널 Claude 비서 만들기.

**핵심 컴포넌트들:**
- 에이전트 코어로서의 **Claude Agent SDK**
- 격리된 에이전트 실행 환경을 위한 **컨테이너 (Linux VMs)**
- 주요 I/O 채널로서의 **WhatsApp**
- 대화방(Session) 단위, 글로벌 단위 데이터 보존을 위한 **영구 메모리** 구성
- Claude를 실행시키고 나중에 회신을 남길 수 있도록 해주는 **예약 주기 작업 (Scheduled tasks)**
- 검색과 브라우징을 위한 **웹 엑세스 (Web access)**
- agent-browser 라이브러리를 통한 **브라우저 행동 자동화**

**구현 접근 방식:**
- 기존의 안정적인 도구들 활용 (WhatsApp 커넥터, Claude Agent SDK, MCP 서버스)
- 각 파이프를 붙여줄 최소한의 풀칠(glue) 코드 사용
- 가능하다면 파일 기반 시스템 지향 (메모리 관리를 위한 `CLAUDE.md`, 채팅 그룹을 위한 폴더 등)

---

## 아키텍처 의사결정 기록

### 메시지 라우팅 구조
- 라우터(Router)가 WhatsApp을 주시하고 설정값에 기반하여 메시지를 라우팅합니다.
- 등록된 채널 그룹(Registered groups)에서 온 메시지만 처리합니다.
- 트리거 발동 단어: `@Andy` 접두사 (대소문자 미구분), `ASSISTANT_NAME` 환경변수를 통해 변경할 수 있습니다.
- 등록되지 않은 곳에서 온 메시지들은 철저히 무시합니다.

### 기억 연상 시스템 (Memory System)
- **그룹별 메모리(Per-group)**: 각 대화방(그룹)은 자체 `CLAUDE.md`를 포함한 폴더를 가집니다.
- **공용 메모리 (Global memory)**: 모든 채팅방이 읽을 수 있지만, 오직 "메인(Main)" 그룹(자신에게 메시지 보내기)에서만 수정, 쓰기가 가능한 최상위 `CLAUDE.md` 파일 지원.
- **파일**: 채팅방 그룹들은 할당된 폴더 안에서 파일을 생성하고 읽고 참조할 수 있습니다.
- 에이전트는 해당 그룹의 폴더에서 구동되며, 자동으로 그룹 메모리와 글로벌 메모리(CLAUDE.md) 모두를 상속하여 읽습니다.

### 세션 관리 
- 각 채팅방은 자신만의 대화 세션을 유지합니다 (Claude Agent SDK 활용).
- 컨텍스트(대화 기록)가 너무 길어지면 시스템이 중요한 정보를 보존하고 자동으로 세션을 슬림화 압축시킵니다.

### 컨테이너를 통한 격리 원칙
- 모든 에이전트들은 가벼운 Linux VM 구조인 컨테이너 내부에서만 동작합니다.
- 에이전트가 호출될 때마다 제한적으로 승인된 특정 디렉토리 폴더만 마운트시킨 일회용 컨테이너를 하나 생성(Spawn)해냅니다.
- 이 컨테이너들은 파일 시스템 격리 공간을 제공합니다 - 에이전트들은 자신에게 허가(Mounted)된 경로만 볼 수 있습니다.
- Bash 접근 권한은 시스템 호스트가 아닌 컨테이너 내부에서만 통용되므로 안전합니다.
- 브라우저 자동화의 경우 컨테이너 이미지 내부의 Chromium을 활용하여 안전하게 agent-browser를 호출합니다.

### 예약된 태스크 기능 (Scheduled Tasks)
- 사용자는 어떤 대화방에서든 Claude에게 단발성이거나 반복적으로 실행되는 태스크 작업을 예약하도록 지시할 수 있습니다.
- 이 태스크들은 그 요청이 만들어졌던 대화방 컨텍스트를 품은 완전한 권한의 에이전트 형태로 실행됩니다.
- 태스크 에이전트들은 안전한 컨테이너 속에서 Bash 커맨드 등을 포함한 모든 툴 사용 권한을 가집니다.
- 태스크 작업은 `send_message` 도구로 결과를 다시 그룹 채팅방에 보낼 수도, 아니면 메세지를 남기지 않고 조용하게 작업을 끝마칠 수도 있습니다.
- 태스크 실행 결과는 기간이나 결과값들과 함께 데이터베이스에 꼼꼼히 기록됩니다.
- 스케쥴 타임 유형 예시: Cron 표현식, 밀리초 단위 간격 처리, 혹은 ISO 타임스탬프를 통한 특정 1회 지정 실행 등 
- 메인(본인 1:1) 방에서는 모든 채널 그룹용 스케줄 작업을 예약시키거나 관리/열람할 수 있습니다.
- 그 외의 그룹 방에서는 오직 자신 그룹 내의 예약 태스크들만 조회하거나 취소/관리 가능합니다.

### 그룹 관리 방식
- 새로운 그룹 등록은 메인 관리자 채널을 통해서만 명시적으로 이뤄집니다.
- 새 그룹은 메인 채널의 승인 후, SQLite DB에 등록됩니다 (혹은 IPC `register_group` 내부 커맨드를 통해).
- 각각의 신규 그룹은 `groups/` 아래 전용 폴더 영역 한 곳을 격리 배정 받습니다.
- 그룹별 설정 `containerConfig` 을 통해 필요시 추가 디렉토리 마운트 권한을 오픈해줄 수 있습니다.

### 메인 채널(Main Channel) 전용 특권 기능
- 메인 채널은 관리용/컨트롤 그룹 채널의 역할을 담당합니다 (대부분 자신에게 카톡보내기를 권장합니다)
- 코어 글로벌 메모리에 정보를 전파, 기록할 수 있습니다 (`groups/CLAUDE.md` 수정 기능) 
- 다른 모든 그룹의 작업을 백그라운드 스케쥴 지정하거나 현황 조회, 취소 관리 등을 할 수 있습니다.
- 어떤 그룹이든 추가 디렉토리 마운트 설정을 해제 혹은 허용해주는 관리 설정자 역할을 합니다.

---

## 연동 포인트 (Integration Points)

### WhatsApp
- WhatsApp Web 연결을 위해 baileys 라이브러리 사용.
- 수신 메시지는 SQLite DB에 캐시 저장되며 라우터는 1초마다 DB를 폴링(Polling)함.
- 셋업 과정 중 QR 코드를 통한 로그인 인증 필수.

### 스케줄러 (Scheduler)
- 내장 스케줄러는 백그라운드 호스트에서 상시 실행 중이며 조건 충족 시 작업을 처리할 컨테이너를 새로 탄생시킵니다 (Spawns).
- 커스텀 `nanoclaw` 전용 MCP 서버가 컨테이너 내부에 내장되어 예약/관련 툴들을 제공해줍니다.
- 기본 탑재 스케줄툴: `schedule_task`, `list_tasks`, `pause_task`, `resume_task`, `cancel_task`, `send_message`
- 실행 이력 등은 SQLite DB 저장
- 스케줄러 루프 주기(1분 단위 체크)
- 태스크들은 모두 각 컨테이너 내부의 격리된 그룹 컨텍스트 환경 기반인 Claude Agent SDK 포맷으로 구동됨 

### Web Access (웹 접근)
- 기본 스펙으로 웹 검색(WebSearch)과 웹 화면 긁어오기(WebFetch) 툴들을 제공함.
- 표준 Claude Agent SDK 의 능력을 온전히 따라감

### Browser Automation (브라우저 제어 자동화)
- 컨테이너 내부의 Chromium 과 연계되어 agent-browser CLI 기능을 지원함
- 화면 구성을 요소 객체화(@e1, @e2) 형태로 만든 스냅샷 기반의 인터렉션 방식 지원
- 스크린샷 캡쳐 제공, PDF 생성 지원, 비디오 기록 가능
- 로그인/인증 상태 보존 (Persistant State) 지원

---

## 설치 시스템 구조 (Setup & Customization)

### 설계 철학
- 번잡한 설정 파일 양산은 지양함.
- 셋업과 커스텀 과정은 모두 Claude Code 를 거쳐 이뤄지도록 함.
- 사용자들은 코드를 복사(Clone) 받은 후, 그저 터미널에서 Claude Code 를 실행해 세팅만 완료해 주면 됨 
- "각 사용자는 본인만의 니즈를 완벽하게 반영한 별도의 NanoClaw 코드 시스템을 획득한다"를 모토로 함.

### 기본 스킬 
- `/setup` - 의존성 패키지 설치, WhatsApp 초기 로그인 연동 통신망, 스케줄러 시스템 정비, 데몬 서비스 자동 기동 등의 코어셋.
- `/customize` - 일반적인 사용 범위 내의 시스템 추가 능력(텔레그램 전환, 새로운 통합 기능 등록, 혹은 동작 규칙 변경)을 수행해줄 범용 스킬명 
- `/update` - NanoClaw 원본 상위 버전(Upstream) 변경사항의 내용을 당겨와서 사용자 커스텀 설정들과 병합(Merge)한 뒤 마이그레이션 실행 등의 종합 백업 솔루션.

### 디플로이(배포/가동)
- macOS 기반의 예약 기동 데몬 서비스인 `launchd` 로컬 스크립트 실행으로 상시 가동 지원.
- 모든 것을 통제하는 중심 Node.js 백그라운드 프로세스는 딱 하나.

--- 

## 개인 구성 (단순 참고용)

이 프로젝트 창시자 본인이 세팅하여 사용 중인 참고용 옵션 모음입니다:

- **트리거 규칙**: `@Andy` 대소문자 구별 없음.
- **반응(응답) 시 접두사**: `Andy:` 라고 붙이며 말함.
- **아바타 성격(페르소나)**: 그냥 기본 Claude 사용 (별도로 쿨함, 재밌음 등의 성격 부여는 안 함).
- **메인 채널(관리자)**: 나와의 채팅 공간 (나한테 WhatsApp 1인 메시지 보내기).

---

## 프로젝트 이름

**NanoClaw** - 나노 사이즈의 아주 작고 가벼운, 예전 Clawdbot(현재 OpenClaw) 이라는 거대 프로젝트에 대한 트리뷰트.
